{% extends "layouts/base.html" %}

{% block title %}Dashboard - Manual Purchase Agent{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Dashboard Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2"><i class="fas fa-chart-line me-2"></i>Dashboard</h1>
        <div class="btn-group">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="fas fa-calendar-alt me-1"></i> Time Range: Last 30 Days
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Today</a></li>
                <li><a class="dropdown-item" href="#">Last 7 Days</a></li>
                <li><a class="dropdown-item active" href="#">Last 30 Days</a></li>
                <li><a class="dropdown-item" href="#">This Year</a></li>
                <li><a class="dropdown-item" href="#">All Time</a></li>
            </ul>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-2">Manuals Processed</h6>
                            <h2 class="mb-0">247</h2>
                        </div>
                        <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                            <i class="fas fa-book text-primary fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-3 small text-success">
                        <i class="fas fa-arrow-up me-1"></i>8.3% from last period
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-2">Parts Identified</h6>
                            <h2 class="mb-0">1,842</h2>
                        </div>
                        <div class="rounded-circle bg-success bg-opacity-10 p-3">
                            <i class="fas fa-cogs text-success fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-3 small text-success">
                        <i class="fas fa-arrow-up me-1"></i>12.7% from last period
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-2">Suppliers Found</h6>
                            <h2 class="mb-0">328</h2>
                        </div>
                        <div class="rounded-circle bg-info bg-opacity-10 p-3">
                            <i class="fas fa-store text-info fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-3 small text-success">
                        <i class="fas fa-arrow-up me-1"></i>5.2% from last period
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-2">Purchases Completed</h6>
                            <h2 class="mb-0">79</h2>
                        </div>
                        <div class="rounded-circle bg-warning bg-opacity-10 p-3">
                            <i class="fas fa-shopping-cart text-warning fa-2x"></i>
                        </div>
                    </div>
                    <div class="mt-3 small text-warning">
                        <i class="fas fa-arrow-down me-1"></i>2.1% from last period
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4 mb-4">
        <div class="col-md-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">System Activity</h5>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary active">Daily</button>
                        <button class="btn btn-outline-secondary">Weekly</button>
                        <button class="btn btn-outline-secondary">Monthly</button>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="activityChart" height="300"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">Part Categories</h5>
                </div>
                <div class="card-body">
                    <canvas id="categoryChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Purchase Status and Recent Activity -->
    <div class="row g-4">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">Purchase Status</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <h6 class="mb-1">Completed</h6>
                                <p class="small text-muted mb-0">Successfully processed purchases</p>
                            </div>
                            <span class="badge bg-success rounded-pill">52</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <h6 class="mb-1">In Progress</h6>
                                <p class="small text-muted mb-0">Currently being processed</p>
                            </div>
                            <span class="badge bg-warning rounded-pill">18</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <h6 class="mb-1">Failed</h6>
                                <p class="small text-muted mb-0">Encountered errors during processing</p>
                            </div>
                            <span class="badge bg-danger rounded-pill">9</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <h6 class="mb-1">Waiting for Approval</h6>
                                <p class="small text-muted mb-0">Manual review requested</p>
                            </div>
                            <span class="badge bg-info rounded-pill">6</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Recent Activity</h5>
                    <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item px-3 py-3">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1"><i class="fas fa-shopping-cart text-primary me-2"></i>Purchase Completed</h6>
                                <small class="text-muted">10 min ago</small>
                            </div>
                            <p class="mb-1 small">Successfully purchased Toyota Camry Air Filter (Part #87139-06030)</p>
                            <small class="text-muted">OrderID: #ORD-9385</small>
                        </div>
                        <div class="list-group-item px-3 py-3">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1"><i class="fas fa-book text-success me-2"></i>Manual Processed</h6>
                                <small class="text-muted">25 min ago</small>
                            </div>
                            <p class="mb-1 small">Honda CRV 2022 Technical Manual processed successfully</p>
                            <small class="text-muted">Extracted 24 part numbers and 8 error codes</small>
                        </div>
                        <div class="list-group-item px-3 py-3">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1"><i class="fas fa-exclamation-triangle text-warning me-2"></i>Purchase Alert</h6>
                                <small class="text-muted">1 hour ago</small>
                            </div>
                            <p class="mb-1 small">Price increase detected for Part #43165-TK8-A10</p>
                            <small class="text-muted">15.4% increase since last check</small>
                        </div>
                        <div class="list-group-item px-3 py-3">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1"><i class="fas fa-cogs text-info me-2"></i>Part Resolved</h6>
                                <small class="text-muted">2 hours ago</small>
                            </div>
                            <p class="mb-1 small">Generic "Front Brake Caliper" resolved to OEM #47750-33320</p>
                            <small class="text-muted">Confidence: 97.5%</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Activity Chart
    const activityCtx = document.getElementById('activityChart').getContext('2d');
    const activityChart = new Chart(activityCtx, {
        type: 'line',
        data: {
            labels: ['May 1', 'May 5', 'May 10', 'May 15', 'May 20', 'May 25', 'May 30'],
            datasets: [
                {
                    label: 'Manuals',
                    data: [12, 19, 10, 15, 22, 18, 15],
                    borderColor: '#0d6efd',
                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Parts',
                    data: [65, 59, 80, 81, 90, 85, 78],
                    borderColor: '#198754',
                    backgroundColor: 'rgba(25, 135, 84, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Purchases',
                    data: [5, 10, 7, 12, 9, 11, 14],
                    borderColor: '#ffc107',
                    backgroundColor: 'rgba(255, 193, 7, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Category Chart
    const categoryCtx = document.getElementById('categoryChart').getContext('2d');
    const categoryChart = new Chart(categoryCtx, {
        type: 'doughnut',
        data: {
            labels: ['Filters', 'Brakes', 'Electrical', 'Engine', 'Suspension', 'Other'],
            datasets: [{
                data: [25, 20, 18, 15, 12, 10],
                backgroundColor: [
                    '#0d6efd',
                    '#198754',
                    '#ffc107',
                    '#dc3545',
                    '#6f42c1',
                    '#adb5bd'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });
});
</script>
{% endblock %}